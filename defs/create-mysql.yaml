type: layout-form
id: root
header:
  - type: header
    title: MySQL
    logo: icon.webp
form:
  - $include: __resource_group_select_or_create.yaml

  - type: fieldset
    id: fieldset-container-instance-creation
    subitems:
      - $include: __region_selector.yaml
        prefix: mysql_server_
      - type: row
        subitems:
          - type: textfield
            id: container-instance-name-field
            name: Server Name
            produces:
              - variable: mysql_server_name
                regex: ^[a-z0-9][-a-z0-9]*(?<!-)$
      - type: row
        subitems:
          - type: textfield
            name: User Name
            produces:
              - variable: mysql_server_username
      - type: row
        subitems:
          - type: textfield
            name: Password
            produces:
              - variable: mysql_server_password
      - $include: __mysql_vm_size_selector.yaml
      - type: 'action-row'
        name: Create MySQL Server
        consumes:
          - variable: resource_group_name
          - variable: mysql_server_name
          - variable: mysql_server_username
          - variable: mysql_server_password
        verify: |
            az mysql flexible-server show --resource-group ${resource_group_name} --name ${mysql_server_name}
        install: az mysql flexible-server create --resource-group ${resource_group_name} --name ${mysql_server_name} --admin-user ${mysql_server_username} --admin-password ${mysql_server_password} --sku-name Basic
        uninstall: az mysql flexible-server delete --resource-group ${resource_group_name} --name ${mysql_server_name}

footer:
  - type: footer
    id: footer
    subitems:
      - type: button
        id: install_button
        text: Create
