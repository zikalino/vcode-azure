type: layout-form
id: root
header:
  - type: header
    title: Virtual Machine
    logo: icon.webp
form:
  - $include: __resource_group_select_or_create.yaml

  - type: fieldset
    subitems:
      - type: text-block
        font: header-1
        content: OS Disk

      - type: radio-group
        subitems:
          - type: radio
            value: default
            text: Default
            variable: os_disk_creation
            default: true
          - type: radio
            value: attach
            text: Attach Existing
            variable: os_disk_creation
          - type: radio
            value: image
            text: From Image
            variable: os_disk_creation

      - $include: __disk_selector.yaml
        prefix: os_
        show-if:
          variable: os_disk_creation
          value: attach

  - type: fieldset
    subitems:
      - type: text-block
        font: header-1
        content: Data Disks
      - type: radio-group
        subitems:
          - type: radio
            value: default
            text: Default
            variable: data_disk_creation
            default: true
          - type: radio
            value: attach
            text: Attach Existing
            variable: data_disk_creation
          - type: radio
            value: empty
            text: Empty
            variable: data_disk_creation
      - $include: __disk_selector.yaml
        prefix: data_
        show-if:
          variable: data_disk_creation
          value: attach


  - type: fieldset
    subitems:
      - type: row
        subitems:
          - type: textfield
            name: Name
            produces:
              - variable: virtual_machine_name
      - type: row
        subitems:
          - type: combo
            name: Select Region
            id: virtual_machine_region_combo
            items: []
            source:
              cmd: |
                az account list-locations
              path-id: $[*].name
              path-name: $[*].displayName
            produces:
              - variable: virtual_machine_region
      - $include: __vm_size_selector.yaml
      - $include: __subnet_selector.yaml
      - type: 'action-row'
        name: Create Virtual Machine
        consumes:
          - variable: resource_group_name
          - variable: virtual_machine_name
          - variable: virtual_machine_region
          - variable: os_disk_id
            parameter: --attach-os-disk ${os_disk_id}
            required: false
            required-if:
              variable: os_disk_creation
              value: attach
          - variable: data_disk_id
            parameter: --attach-data-disks ${data_disk_id}
            required: false
            required-if:
              variable: data_disk_creation
              value: attach
        verify: |
            az vm show --resource-group ${resource_group_name} --name ${virtual_machine_name}
        install: az vm create --resource-group ${resource_group_name} --name ${virtual_machine_name} --location ${virtual_machine_region}
        uninstall: az vm delete --resource-group ${resource_group_name} --name ${virtual_machine_name} --yes

footer:
  - type: footer
    id: footer
    subitems:
      - type: button
        id: install_button
        text: Create
