type: layout-form
id: root
header:
  - type: header
    title: Virtual Network
    logo: icon.webp
form:
  - $include: __resource_group_select_or_create.yaml

  - type: fieldset
    subitems:
      - type: row
        subitems:
          - type: textfield
            name: Name
            variable: vnet_name
            id: vnet-name-field
      - type: row
        subitems:
          - type: combo
            name: Select Region
            id: vnet_region_combo
            items: []
            source:
              cmd: |
                az account list-locations
              path-id: $[*].name
              path-name: $[*].displayName
            produces:
              - variable: vnet_region
      - type: 'action-row'
        name: Create Virtual Network
        consumes:
          - resource_group_name
          - vnet_name
          - vnet_region
        verify: |
            az network vnet show --resource-group ${resource_group_name} --name ${vnet_name}
        install: az network vnet create --resource-group ${resource_group_name} --name ${vnet_name} --location ${vnet_region}
        uninstall: az network vnet delete --resource-group ${resource_group_name} --name ${vnet_name}

  #
  # SUBNET
  #
  - type: fieldset
    subitems:
      - type: row
        subitems:
          - type: textfield
            name: Name
            variable: subnet_name
      - type: row
        subitems:
          - type: textfield
            name: Address Prefixes
            variable: address_prefixes
      - type: 'action-row'
        name: Create Virtual Network
        consumes:
          - resource_group_name
          - vnet_name
          - subnet_name
          - address_prefixes
        verify: |
             az network vnet subnet show --name ${subnet_name} --vnet-name ${vnet_name} --resource-group ${resource_group_name}
        install: az network vnet subnet create --name ${subnet_name} --vnet-name ${vnet_name} --resource-group ${resource_group_name} --address-prefixes ${address_prefixes}
        uninstall: az network vnet subnet delete --name ${subnet_name} --vnet-name ${vnet_name} --resource-group ${resource_group_name}

footer:
  - type: footer
    id: footer
    subitems:
      - type: button
        id: install_button
        text: Install
